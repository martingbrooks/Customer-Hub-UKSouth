{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "topLevelAggregator": {
            "defaultValue": "tla",
            "type": "string"
        },
        "thirdOctectNumber": { 
            "defaultValue": "0",
            "type": "string"
        },
        "resourceLocation": {
        	"defaultValue": "null",
            "type": "string"
        },
        "environment": {
        	"defaultValue": "null",
            "type": "string"
        }   
    },
    "variables": {
      "destinationRoutes": [
        {
          "addressPrefix": "0.0.0.0/0",
          "name": "[concat(parameters('topLevelAggregator'),'-',parameters('resourceLocation'),'-default')]",
          "nextHopType": "VirtualAppliance",
          "nextHopIpAddress": "[concat('100.64.',parameters('thirdOctectNumber'),'.4')]"
        },
        {
          "addressPrefix": "100.64.13.0/29",
          "name": "[concat(parameters('topLevelAggregator'),'-',parameters('resourceLocation'),'-to-firewallinside-subnet')]",
          "nextHopType": "VirtualAppliance",
          "nextHopIpAddress": "[concat('100.64.',parameters('thirdOctectNumber'),'.4')]"
        },
        {
          "addressPrefix": "100.64.13.8/27",
          "name": "[concat(parameters('topLevelAggregator'),'-',parameters('resourceLocation'),'-to-firewallinside-subnet')]",
          "nextHopType": "VirtualAppliance",
          "nextHopIpAddress": "[concat('100.64.',parameters('thirdOctectNumber'),'.4')]"
        },
        {
          "addressPrefix": "100.97.13.64/28",
          "name": "[concat(parameters('topLevelAggregator'),'-',parameters('resourceLocation'),'-to-TPA1-subnet')]",
          "nextHopType": "VirtualAppliance",
          "nextHopIpAddress": "[concat('100.64.',parameters('thirdOctectNumber'),'.4')]"
        },
        {
          "addressPrefix": "100.64.64.80/28",
          "name": "[concat(parameters('topLevelAggregator'),'-',parameters('resourceLocation'),'-to-TPA2-subnet')]",
          "nextHopType": "VirtualAppliance",
          "nextHopIpAddress": "[concat('100.64.',parameters('thirdOctectNumber'),'.4')]"
        },
        {
          "addressPrefix": "100.64.64.96/28",
          "name": "[concat(parameters('topLevelAggregator'),'-',parameters('resourceLocation'),'-to-TPA3-subnet')]",
          "nextHopType": "VirtualAppliance",
          "nextHopIpAddress": "[concat('100.64.',parameters('thirdOctectNumber'),'.4')]"
        },
        {
          "addressPrefix": "100.64.64.112/29",
          "name": "[concat(parameters('topLevelAggregator'),'-',parameters('resourceLocation'),'-to-transit-subnet')]",
          "nextHopType": "VirtualAppliance",
          "nextHopIpAddress": "[concat('100.64.',parameters('thirdOctectNumber'),'.4')]"
        },
        {
          "addressPrefix": "100.64.64.120/29",
          "name": "[concat(parameters('topLevelAggregator'),'-',parameters('resourceLocation'),'-to-firewalloutside-subnet')]",
          "nextHopType": "VirtualAppliance",
          "nextHopIpAddress": "[concat('100.64.',parameters('thirdOctectNumber'),'.4')]"
        }
      ]
    },	
    "resources": [
        {
            "type": "Microsoft.Network/routeTables",
            "apiVersion": "2019-04-01",
            "name": "[concat('route-',parameters('topLevelAggregator'),'-firewallinsideroutetable-',parameters('environment'),'-',parameters('resourceLocation'),'-001')]",
            "location": "[parameters('resourceLocation')]",
            "properties": {
                "copy": [
                    {
                        "name": "routes",
                        "count": "[length(variables('destinationRoutes'))]",
                        "input": {
                            "name": "[variables('destinationRoutes')[copyIndex('routes')].name]",
                            "properties": {
                                "addressPrefix": "[variables('destinationRoutes')[copyIndex('routes')].addressPrefix]",
                                "nextHopType": "[variables('destinationRoutes')[copyIndex('routes')].nextHopType]",
                                "nextHopIpAddress": "[variables('destinationRoutes')[copyIndex('routes')].nextHopIpAddress]"
                            }
                        }
                    }
                ]
            }
    	}
    ]
}
